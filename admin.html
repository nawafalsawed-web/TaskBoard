<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ… - Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&family=Changa:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main:#0f1119; --bg-card:#1a1d2e; --bg-input:#141726;
            --accent-purple:#8b5cf6; --accent-purple-light:#a78bfa;
            --accent-green:#34d399; --accent-green-dark:#059669;
            --accent-red:#ef4444; --accent-red-light:#f87171; --accent-amber:#f59e0b;
            --text-white:#f1f5f9; --text-muted:#94a3b8; --text-dim:#64748b;
            --border:rgba(139,92,246,0.15); --border-active:rgba(139,92,246,0.4);
            --progress-low:#e74c3c; --progress-mid:#f39c12; --progress-high:#27ae60; --progress-full:#2ecc71;
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Tajawal',sans-serif;background:var(--bg-main);color:var(--text-white);min-height:100vh}
        .header{background:linear-gradient(135deg,#1a1d2e,#0f1119);border-bottom:1px solid var(--border);padding:1.2rem 2rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
        .header-title{font-family:'Changa',sans-serif;font-weight:800;font-size:1.5rem;background:linear-gradient(135deg,var(--accent-purple),var(--accent-green));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .header-subtitle{font-size:0.85rem;color:var(--text-dim);margin-top:0.2rem}
        .status-badge{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 1rem;border-radius:50px;font-size:0.85rem}
        .status-badge.on{background:rgba(52,211,153,0.1);border:1px solid rgba(52,211,153,0.2);color:var(--accent-green)}
        .status-badge.off{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);color:var(--accent-red-light)}
        .status-dot{width:8px;height:8px;border-radius:50%;animation:pulse 2s infinite}
        .status-badge.on .status-dot{background:var(--accent-green)} .status-badge.off .status-dot{background:var(--accent-red)}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
        .main-content{display:grid;grid-template-columns:1fr 2fr;gap:1.5rem;padding:1.5rem 2rem;max-width:1600px;margin:0 auto}
        .sidebar{display:flex;flex-direction:column;gap:1.5rem}
        .panel{background:var(--bg-card);border-radius:16px;border:1px solid var(--border);overflow:hidden}
        .panel:hover{border-color:var(--border-active)}
        .panel-header{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.5rem;background:rgba(139,92,246,0.05);border-bottom:1px solid var(--border)}
        .panel-title{font-family:'Changa',sans-serif;font-weight:700;font-size:1.1rem;color:var(--accent-purple-light)}
        .panel-body{padding:1.5rem}
        .form-group{margin-bottom:1.2rem} .form-group:last-child{margin-bottom:0}
        .form-label{display:block;font-size:0.85rem;color:var(--text-muted);margin-bottom:0.5rem;font-weight:500}
        .form-input{width:100%;padding:0.75rem 1rem;background:var(--bg-input);border:1px solid var(--border);border-radius:10px;color:var(--text-white);font-family:'Tajawal',sans-serif;font-size:0.95rem;direction:rtl}
        .form-input:focus{outline:none;border-color:var(--accent-purple);box-shadow:0 0 0 3px rgba(139,92,246,0.1)}
        textarea.form-input{resize:vertical;min-height:100px;line-height:1.8}
        .btn-success{width:100%;display:flex;justify-content:center;padding:1rem;font-size:1.1rem;border:none;border-radius:10px;font-family:'Tajawal',sans-serif;font-weight:700;cursor:pointer;background:linear-gradient(135deg,var(--accent-green-dark),#047857);color:white}
        .btn-success:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(52,211,153,0.3)}
        .tasks-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
        .section-card{background:var(--bg-card);border-radius:16px;border:1px solid var(--border);overflow:hidden}
        .section-card:hover{border-color:var(--border-active)}
        .section-header{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.5rem;background:rgba(139,92,246,0.05);border-bottom:1px solid var(--border)}
        .section-title-input{background:transparent;border:none;color:var(--accent-purple-light);font-family:'Changa',sans-serif;font-weight:700;font-size:1.1rem;width:100%;padding:0.2rem 0;border-bottom:1px dashed transparent}
        .section-title-input:hover{border-bottom-color:var(--border)} .section-title-input:focus{outline:none;border-bottom-color:var(--accent-purple)}
        .task-count{font-size:0.8rem;color:var(--text-dim);background:rgba(139,92,246,0.1);padding:0.2rem 0.6rem;border-radius:50px;white-space:nowrap}
        .section-body{padding:1rem 1.5rem}
        .task-add-row{display:flex;gap:0.5rem;margin-bottom:1rem}
        .task-add-input{flex:1;padding:0.6rem 1rem;background:var(--bg-input);border:1px solid var(--border);border-radius:10px;color:var(--text-white);font-family:'Tajawal',sans-serif;font-size:0.9rem;direction:rtl}
        .task-add-input:focus{outline:none;border-color:var(--accent-purple)} .task-add-input::placeholder{color:var(--text-dim)}
        .btn-add{padding:0.6rem 0.8rem;background:rgba(52,211,153,0.15);border:1px solid rgba(52,211,153,0.2);color:var(--accent-green);border-radius:10px;cursor:pointer;font-size:1.1rem;min-width:38px;display:flex;align-items:center;justify-content:center}
        .btn-add:hover{background:rgba(52,211,153,0.25)}
        .task-items-list{display:flex;flex-direction:column;gap:0.5rem;max-height:350px;overflow-y:auto}
        .task-items-list::-webkit-scrollbar{width:4px} .task-items-list::-webkit-scrollbar-thumb{background:rgba(139,92,246,0.3);border-radius:4px}
        .task-row{display:flex;flex-direction:column;gap:0.4rem;padding:0.7rem 0.8rem;background:rgba(255,255,255,0.03);border-radius:10px;border:1px solid transparent}
        .task-row:hover{background:rgba(255,255,255,0.06);border-color:rgba(139,92,246,0.08)}
        .task-top-row{display:flex;align-items:center;gap:0.5rem}
        .drag-handle{cursor:grab;color:var(--text-dim);font-size:0.8rem;opacity:0;transition:opacity 0.2s}
        .task-row:hover .drag-handle{opacity:1}
        .task-text{flex:1;font-size:0.9rem;color:var(--text-white)}
        .task-edit-input{flex:1;background:var(--bg-input);border:1px solid var(--accent-purple);border-radius:6px;color:var(--text-white);font-family:'Tajawal',sans-serif;font-size:0.9rem;padding:0.3rem 0.6rem;direction:rtl}
        .task-edit-input:focus{outline:none}
        .task-actions{display:flex;gap:0.3rem;opacity:0;transition:opacity 0.2s}
        .task-row:hover .task-actions{opacity:1}
        .btn-icon{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border:none;border-radius:6px;cursor:pointer;font-size:0.8rem;background:transparent}
        .btn-icon.edit{color:var(--accent-amber)} .btn-icon.edit:hover{background:rgba(245,158,11,0.15)}
        .btn-icon.delete{color:var(--accent-red)} .btn-icon.delete:hover{background:rgba(239,68,68,0.15)}
        .progress-row{display:flex;align-items:center;gap:0.5rem;direction:ltr}
        .progress-slider{flex:1;-webkit-appearance:none;appearance:none;height:6px;border-radius:10px;outline:none;cursor:pointer}
        .progress-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;cursor:pointer;border:2px solid #1a1d2e;box-shadow:0 2px 6px rgba(0,0,0,0.3)}
        .progress-slider::-moz-range-thumb{width:16px;height:16px;border-radius:50%;cursor:pointer;border:2px solid #1a1d2e}
        .progress-slider.low::-webkit-slider-thumb{background:var(--progress-low)} .progress-slider.mid::-webkit-slider-thumb{background:var(--progress-mid)}
        .progress-slider.high::-webkit-slider-thumb{background:var(--progress-high)} .progress-slider.full::-webkit-slider-thumb{background:var(--progress-full)}
        .progress-value{font-size:0.75rem;font-weight:700;min-width:32px;text-align:center;padding:0.1rem 0.3rem}
        .progress-value.low{color:var(--progress-low)} .progress-value.mid{color:var(--progress-mid)}
        .progress-value.high{color:var(--progress-high)} .progress-value.full{color:var(--progress-full)}
        .quick-btns{display:flex;gap:0.2rem}
        .quick-btn{font-size:0.65rem;padding:0.15rem 0.35rem;border-radius:4px;border:1px solid var(--border);background:transparent;color:var(--text-dim);cursor:pointer;font-family:'Tajawal',sans-serif}
        .quick-btn:hover{background:rgba(139,92,246,0.15);color:var(--accent-purple-light);border-color:var(--accent-purple)}
        .empty-tasks{text-align:center;color:var(--text-dim);font-size:0.85rem;padding:1.5rem 0}
        .toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(100px);background:var(--accent-green-dark);color:white;padding:0.8rem 2rem;border-radius:12px;font-weight:700;font-size:0.95rem;box-shadow:0 8px 32px rgba(0,0,0,0.4);transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);z-index:1000}
        .toast.show{transform:translateX(-50%) translateY(0)}
        .loading-overlay{position:fixed;inset:0;background:rgba(15,17,25,0.95);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:999;transition:opacity 0.5s}
        .loading-overlay.hidden{opacity:0;pointer-events:none}
        .loading-spinner{width:40px;height:40px;border:4px solid rgba(139,92,246,0.2);border-top-color:var(--accent-purple);border-radius:50%;animation:spin 0.8s linear infinite}
        .loading-text{margin-top:1rem;font-family:'Changa',sans-serif;color:var(--accent-purple-light);font-weight:700}
        @keyframes spin{to{transform:rotate(360deg)}}

        @media(max-width:1200px){.main-content{grid-template-columns:1fr}.tasks-grid{grid-template-columns:1fr 1fr}}
        @media(max-width:768px){
            .header{padding:0.8rem 1rem} .header-title{font-size:1.2rem} .header-subtitle{font-size:0.75rem}
            .status-badge{font-size:0.75rem;padding:0.4rem 0.7rem}
            .main-content{grid-template-columns:1fr;padding:1rem;gap:1rem}
            .tasks-grid{grid-template-columns:1fr;gap:1rem}
            .panel-body{padding:1rem} .form-input{font-size:0.9rem;padding:0.65rem 0.8rem}
            .section-header{padding:0.8rem 1rem} .section-title-input{font-size:1rem}
            .section-body{padding:0.8rem 1rem} .task-add-input{font-size:0.85rem;padding:0.55rem 0.8rem}
            .task-row{padding:0.6rem} .task-text{font-size:0.85rem}
            .task-actions{opacity:1} .drag-handle{display:none}
            .progress-row{flex-wrap:wrap;gap:0.4rem}
            .progress-slider{flex:1;min-width:80px;height:8px}
            .progress-slider::-webkit-slider-thumb{width:20px;height:20px}
            .quick-btns{order:2;width:100%;justify-content:space-between}
            .quick-btn{font-size:0.7rem;padding:0.25rem 0.5rem;flex:1;text-align:center}
            .progress-value{font-size:0.8rem;min-width:36px}
            .btn-icon{width:32px;height:32px;font-size:0.9rem}
            .toast{font-size:0.85rem;padding:0.7rem 1.5rem;bottom:1rem}
        }
        @media(max-width:400px){
            .header{padding:0.7rem 0.8rem} .header-title{font-size:1.1rem}
            .main-content{padding:0.7rem} .panel-body{padding:0.8rem}
            .section-header{padding:0.7rem 0.8rem} .section-body{padding:0.6rem 0.8rem}
            .task-text{font-size:0.8rem}
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>
    <header class="header">
        <div>
            <div class="header-title">âš™ï¸ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…</div>
            <div class="header-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
        </div>
        <div class="status-badge off" id="sb">
            <span class="status-dot"></span>
            <span id="st">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
        </div>
    </header>
    <div class="main-content">
        <div class="sidebar">
            <div class="panel">
                <div class="panel-header"><span class="panel-title">ğŸ’¬ Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…</span></div>
                <div class="panel-body">
                    <div class="form-group"><label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" class="form-input" id="quoteTitle"></div>
                    <div class="form-group"><label class="form-label">Ø§Ù„ÙƒØ§ØªØ¨</label><input type="text" class="form-input" id="quoteAuthor"></div>
                    <div class="form-group"><label class="form-label">Ø§Ù„Ù†Øµ</label><textarea class="form-input" id="quoteText"></textarea></div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header"><span class="panel-title">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</span></div>
                <div class="panel-body">
                    <div class="form-group"><label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</label><input type="text" class="form-input" id="dateHijri"></div>
                    <div class="form-group"><label class="form-label">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‡Ø¬Ø±ÙŠØ©</label><input type="text" class="form-input" id="dateHijriYear"></div>
                    <div class="form-group"><label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</label><input type="text" class="form-input" id="dateGregorian"></div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header"><span class="panel-title">ğŸ”¤ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</span></div>
                <div class="panel-body">
                    <div class="form-group">
                        <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©</label>
                        <div style="display:flex;align-items:center;gap:0.5rem;direction:ltr">
                            <input type="range" min="16" max="60" step="1" class="progress-slider" id="fsQuoteTitle" oninput="ufs('quoteTitle',this.value)" style="flex:1">
                            <span class="progress-value" id="fsQuoteTitleVal" style="color:var(--accent-purple-light)">32px</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„ÙƒØ§ØªØ¨</label>
                        <div style="display:flex;align-items:center;gap:0.5rem;direction:ltr">
                            <input type="range" min="10" max="40" step="1" class="progress-slider" id="fsQuoteAuthor" oninput="ufs('quoteAuthor',this.value)" style="flex:1">
                            <span class="progress-value" id="fsQuoteAuthorVal" style="color:var(--accent-purple-light)">20px</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ù†Øµ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©</label>
                        <div style="display:flex;align-items:center;gap:0.5rem;direction:ltr">
                            <input type="range" min="10" max="30" step="1" class="progress-slider" id="fsQuoteText" oninput="ufs('quoteText',this.value)" style="flex:1">
                            <span class="progress-value" id="fsQuoteTextVal" style="color:var(--accent-purple-light)">16px</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</label>
                        <div style="display:flex;align-items:center;gap:0.5rem;direction:ltr">
                            <input type="range" min="12" max="36" step="1" class="progress-slider" id="fsSectionTitle" oninput="ufs('sectionTitle',this.value)" style="flex:1">
                            <span class="progress-value" id="fsSectionTitleVal" style="color:var(--accent-purple-light)">20px</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ù†Øµ Ø§Ù„Ù…Ù‡Ø§Ù…</label>
                        <div style="display:flex;align-items:center;gap:0.5rem;direction:ltr">
                            <input type="range" min="10" max="26" step="1" class="progress-slider" id="fsTaskName" oninput="ufs('taskName',this.value)" style="flex:1">
                            <span class="progress-value" id="fsTaskNameVal" style="color:var(--accent-purple-light)">14px</span>
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn-success" onclick="saveAll()">ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
        </div>
        <div class="tasks-grid" id="tasksGrid"></div>
    </div>
    <div class="toast" id="toast">âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!</div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script>
        firebase.initializeApp({
            apiKey:"AIzaSyCiyb2ApY6K3YeNdeC6C8wjmWSeNYTZ03E",
            authDomain:"taskboard-ahdaf.firebaseapp.com",
            databaseURL:"https://taskboard-ahdaf-default-rtdb.europe-west1.firebasedatabase.app",
            projectId:"taskboard-ahdaf",
            storageBucket:"taskboard-ahdaf.firebasestorage.app",
            messagingSenderId:"576532765761",
            appId:"1:576532765761:web:33a0cc6888dd229e81fac0"
        });
        var db=firebase.database(),dataRef=db.ref('taskboard');
        var DEFAULT_DATA={sections:{"project-management":{title:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹",tasks:[{name:"Ù…ØªØ§Ø¨Ø¹Ø© Ø¬Ø§Ø²ÙŠ",progress:0},{name:"Ø§Ù‚ÙØ§Ù„ Ø­Ù…Ù„Ø© Ø¯ÙˆÙ„Ø§ØªÙˆ",progress:0},{name:"Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù…Ù„ ÙŠÙ„Ùˆ Ù…Ø¹ Ø§Ù„Ù…Ø¤Ø«Ø±ÙŠÙ†",progress:0},{name:"Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ù…Ù„Ø© ÙØ±Ø´Ù„ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø¤Ø«Ø±ÙŠÙ†",progress:0}]},"influencers":{title:"Ø§Ù„Ù…Ø¤Ø«Ø±ÙŠÙ†",tasks:[{name:"Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø¯ÙŠÙ„ Ø¨Ø§Ù„Ø§Ø³Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠÙ‡",progress:0},{name:"Ù…Ù„Ù ÙƒÙ†ØªØ§ÙƒÙŠ",progress:0},{name:"Ø§Ø¹Ù„Ø§Ù†Ø§Øª Ø¬Ø§Ø²ÙŠ",progress:0},{name:"ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙØ±Ø´Ù„ÙŠ",progress:0},{name:"ØªØ¹Ù…ÙŠØ¯Ø§Øª Ø³Ù„Ùƒ",progress:0},{name:"Ù…ØªØ§Ø¨Ø¹Ù‡ Ø³Ù‡Ù… Ù†Ø´Ø± Ø§Ø¹Ù„Ø§Ù† ÙŠÙ„Ùˆ",progress:0},{name:"Ø±Ø³ÙŠØ³ Ù…Ù„Ù",progress:0},{name:"Ø³ÙŠÙ…ÙÙˆÙ†ÙŠ Ù…Ù‚ØªØ±Ø­Ø§Øª",progress:0},{name:"Ø¯ÙˆÙ„Ø§ØªÙˆ ØªØ¹Ø¯ÙŠÙ„Ø§Øª",progress:0}]},"public-relations":{title:"Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©",tasks:[{name:"Ù†Ø´Ø± Ù„ÙŠÙ†ÙƒØ¯Ù†",progress:0},{name:"Ø®Ø·Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰",progress:0}]},"production":{title:"Ø§Ù„Ø¥Ù†ØªØ§Ø¬",tasks:[{name:"Ø¬Ø¯ÙˆÙ„Ø© ØªØµÙˆÙŠØ± Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª ÙŠÙ„Ùˆ",progress:0},{name:"Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØµÙ…ÙŠÙ… Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø­Ù…Ø¯Ø²",progress:0},{name:"ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…ÙˆØ¬Ø²",progress:0},{name:"ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙŠÙ„Ùˆ",progress:0},{name:"Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¨Ø© Ø§Ù„Ù†Ø§Ø¯Ø±Ø©",progress:0},{name:"Ø¬Ø¯ÙˆÙ„Ø© Ù†Ø´Ø± ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…ÙˆØ¬Ø²",progress:0}]}},quote:{title:"Ø­ÙŠÙ† ØªØªØ­ÙˆÙ‘Ù„ ÙƒØ«Ø±Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ù„Ù‰ Ø¹Ø¨Ø¡",author:"Ù…Ø­Ù…Ø¯ Ø§Ù„Ø­Ø§Ø¬ÙŠ",text:"ÙˆØ¬Ø¯Øª Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø£Ù† Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ø°ÙŠÙ† ØªÙˆÙÙ‘Ø±Øª Ù„Ù‡Ù… Ù…Ø³Ø§Ø±Ø§Øª Ù…Ù‡Ù†ÙŠØ© ÙƒØ«ÙŠØ±Ø© ÙŠØ¹ÙŠØ´ÙˆÙ† Ù‚Ù„Ù‚ Ø£Ø¹Ù„Ù‰ ÙˆØ±Ø¶Ø§ Ù…Ù†Ø®ÙØ¶. Ù…Ù‚Ø§Ø±Ù†Ø©Ù‹ Ø¨Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ù‚Ù„ØŒ ÙØ§Ù„ØªØ¶Ø®Ù… Ø¨Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù„Ø§ ÙŠÙ…Ù†Ø­Ù†Ø§ Ø§Ù„Ø­Ø±ÙŠÙ‘Ø© Ø§Ù„Ù…ÙˆØ¹ÙˆØ¯Ø©ØŒ Ø¨Ù„ ÙŠÙˆÙ„Ø¯ Ù„Ø¯ÙŠÙ†Ø§ Ø­Ø§Ù„Ø© ØªØ´Ø¨Ù‡ Ø´Ù„Ù„ Ø§Ù„Ù‚Ø±Ø§Ø±."},date:{hijri:"Ø§Ù„Ø¥Ø«Ù†ÙŠÙ† - Ù¢Ù¨ - Ø´Ø¹Ø¨Ø§Ù†",hijriYear:"Ù¡Ù¤Ù¤Ù§ / 2026",gregorian:"MON - 16 - FEB"}};

        var currentData=null,isUpdating=false;
        var defaultFS={quoteTitle:32,quoteAuthor:20,quoteText:16,sectionTitle:20,taskName:14};
        function gpc(p){if(p>=100)return'full';if(p>=60)return'high';if(p>=30)return'mid';return'low'}
        function uss(slider,v){var c=gpc(v),cols={low:'#e74c3c',mid:'#f39c12',high:'#27ae60',full:'#2ecc71'};slider.className='progress-slider '+c;slider.style.background='linear-gradient(90deg,'+cols[c]+' 0%,'+cols[c]+' '+v+'%,#333 '+v+'%,#333 100%)'}

        function renderSidebar(){
            document.getElementById('quoteTitle').value=currentData.quote.title||'';
            document.getElementById('quoteAuthor').value=currentData.quote.author||'';
            document.getElementById('quoteText').value=currentData.quote.text||'';
            document.getElementById('dateHijri').value=currentData.date.hijri||'';
            document.getElementById('dateHijriYear').value=currentData.date.hijriYear||'';
            document.getElementById('dateGregorian').value=currentData.date.gregorian||'';
            var fs=currentData.fontSizes||defaultFS;
            var ids=['quoteTitle','quoteAuthor','quoteText','sectionTitle','taskName'];
            for(var j=0;j<ids.length;j++){var id=ids[j];var sl=document.getElementById('fs'+id.charAt(0).toUpperCase()+id.slice(1));var vl=document.getElementById('fs'+id.charAt(0).toUpperCase()+id.slice(1)+'Val');if(sl){sl.value=fs[id]||defaultFS[id]}if(vl){vl.textContent=(fs[id]||defaultFS[id])+'px'}}
        }
        function ufs(key,val){if(!currentData.fontSizes)currentData.fontSizes=JSON.parse(JSON.stringify(defaultFS));currentData.fontSizes[key]=parseInt(val);var vl=document.getElementById('fs'+key.charAt(0).toUpperCase()+key.slice(1)+'Val');if(vl)vl.textContent=val+'px';sfb()}

        function renderTasks(){
            var grid=document.getElementById('tasksGrid');grid.innerHTML='';
            var keys=Object.keys(currentData.sections);
            for(var k=0;k<keys.length;k++){
                var sk=keys[k],sec=currentData.sections[sk],tasks=sec.tasks||[];
                var card=document.createElement('div');card.className='section-card';
                var th='';
                if(tasks.length===0){th='<div class="empty-tasks">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¨Ø¹Ø¯</div>'}
                else{for(var i=0;i<tasks.length;i++){var t=typeof tasks[i]==='string'?{name:tasks[i],progress:0}:tasks[i],c=gpc(t.progress||0);
                th+='<div class="task-row" draggable="true" data-section="'+sk+'" data-index="'+i+'" ondragstart="ds(event)" ondragover="dov(event)" ondrop="dd(event)" ondragend="de(event)">'
                +'<div class="task-top-row"><span class="drag-handle">â‹®â‹®</span><span class="task-text" id="text-'+sk+'-'+i+'">'+t.name+'</span>'
                +'<div class="task-actions"><button class="btn-icon edit" onclick="editTask(\''+sk+'\','+i+')" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button><button class="btn-icon delete" onclick="deleteTask(\''+sk+'\','+i+')" title="Ø­Ø°Ù">ğŸ—‘ï¸</button></div></div>'
                +'<div class="progress-row"><div class="quick-btns">'
                +'<button class="quick-btn" onclick="sp(\''+sk+'\','+i+',0)">0</button>'
                +'<button class="quick-btn" onclick="sp(\''+sk+'\','+i+',25)">25</button>'
                +'<button class="quick-btn" onclick="sp(\''+sk+'\','+i+',50)">50</button>'
                +'<button class="quick-btn" onclick="sp(\''+sk+'\','+i+',75)">75</button>'
                +'<button class="quick-btn" onclick="sp(\''+sk+'\','+i+',100)">100</button>'
                +'</div><input type="range" min="0" max="100" step="5" value="'+(t.progress||0)+'" class="progress-slider '+c+'" id="slider-'+sk+'-'+i+'" oninput="osc(\''+sk+'\','+i+',this.value)">'
                +'<span class="progress-value '+c+'" id="pval-'+sk+'-'+i+'">'+(t.progress||0)+'%</span></div></div>';
                }}
                card.innerHTML='<div class="section-header"><div style="flex:1"><input type="text" class="section-title-input" value="'+sec.title+'" onchange="ust(\''+sk+'\',this.value)"></div><span class="task-count">'+tasks.length+' Ù…Ù‡Ù…Ø©</span></div>'
                +'<div class="section-body"><div class="task-add-row"><input type="text" class="task-add-input" id="add-'+sk+'" placeholder="Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©..." onkeydown="if(event.key===\'Enter\')addTask(\''+sk+'\')"><button class="btn-add" onclick="addTask(\''+sk+'\')">+</button></div>'
                +'<div class="task-items-list" id="list-'+sk+'">'+th+'</div></div>';
                grid.appendChild(card);
            }
            document.querySelectorAll('.progress-slider').forEach(function(s){uss(s,parseInt(s.value))});
        }

        function osc(sk,i,v){var val=parseInt(v);currentData.sections[sk].tasks[i].progress=val;var c=gpc(val);var s=document.getElementById('slider-'+sk+'-'+i);var p=document.getElementById('pval-'+sk+'-'+i);if(s)uss(s,val);if(p){p.textContent=val+'%';p.className='progress-value '+c}sfb()}
        function sp(sk,i,v){currentData.sections[sk].tasks[i].progress=v;var s=document.getElementById('slider-'+sk+'-'+i);if(s){s.value=v;uss(s,v)}var c=gpc(v);var p=document.getElementById('pval-'+sk+'-'+i);if(p){p.textContent=v+'%';p.className='progress-value '+c}sfb()}

        function addTask(sk){var inp=document.getElementById('add-'+sk);var v=inp.value.trim();if(!v)return;if(!currentData.sections[sk].tasks)currentData.sections[sk].tasks=[];currentData.sections[sk].tasks.push({name:v,progress:0});inp.value='';renderTasks();sfb()}
        function deleteTask(sk,i){currentData.sections[sk].tasks.splice(i,1);renderTasks();sfb()}
        function editTask(sk,i){
            var el=document.getElementById('text-'+sk+'-'+i);var t=currentData.sections[sk].tasks[i];var cv=typeof t==='string'?t:t.name;
            var inp=document.createElement('input');inp.type='text';inp.className='task-edit-input';inp.value=cv;
            el.replaceWith(inp);inp.focus();inp.select();
            var save=function(){var nv=inp.value.trim();if(nv){if(typeof currentData.sections[sk].tasks[i]==='string')currentData.sections[sk].tasks[i]={name:nv,progress:0};else currentData.sections[sk].tasks[i].name=nv}renderTasks();sfb()};
            inp.addEventListener('blur',save);inp.addEventListener('keydown',function(e){if(e.key==='Enter')save();if(e.key==='Escape')renderTasks()});
        }
        function ust(sk,v){currentData.sections[sk].title=v;sfb()}

        var draggedItem=null;
        function ds(e){draggedItem=e.target.closest('.task-row');draggedItem.style.opacity='0.5';e.dataTransfer.effectAllowed='move'}
        function dov(e){e.preventDefault();var r=e.target.closest('.task-row');if(r&&r!==draggedItem)r.style.borderTop='2px solid var(--accent-purple)'}
        function dd(e){e.preventDefault();var tgt=e.target.closest('.task-row');if(!tgt||tgt===draggedItem)return;var fs=draggedItem.dataset.section,fi=parseInt(draggedItem.dataset.index),ts=tgt.dataset.section,ti=parseInt(tgt.dataset.index);var task=currentData.sections[fs].tasks.splice(fi,1)[0];currentData.sections[ts].tasks.splice(ti,0,task);renderTasks();sfb()}
        function de(e){document.querySelectorAll('.task-row').forEach(function(el){el.style.borderTop='';el.style.opacity=''});draggedItem=null}

        function csd(){currentData.quote.title=document.getElementById('quoteTitle').value;currentData.quote.author=document.getElementById('quoteAuthor').value;currentData.quote.text=document.getElementById('quoteText').value;currentData.date.hijri=document.getElementById('dateHijri').value;currentData.date.hijriYear=document.getElementById('dateHijriYear').value;currentData.date.gregorian=document.getElementById('dateGregorian').value;if(!currentData.fontSizes)currentData.fontSizes=JSON.parse(JSON.stringify(defaultFS))}
        var st=null;
        function sfb(){csd();clearTimeout(st);st=setTimeout(function(){isUpdating=true;dataRef.set(currentData).then(function(){setTimeout(function(){isUpdating=false},500)})},300)}
        function saveAll(){csd();isUpdating=true;dataRef.set(currentData).then(function(){var t=document.getElementById('toast');t.classList.add('show');setTimeout(function(){t.classList.remove('show')},2500);setTimeout(function(){isUpdating=false},500)})}

        db.ref('.info/connected').on('value',function(s){var e=document.getElementById('sb'),t=document.getElementById('st');if(s.val()){e.className='status-badge on';t.textContent='Ù…ØªØµÙ„'}else{e.className='status-badge off';t.textContent='ØºÙŠØ± Ù…ØªØµÙ„'}});

        var fl=true;
        dataRef.on('value',function(snap){
            if(isUpdating)return;
            var d=snap.val();
            if(d){Object.keys(d.sections).forEach(function(k){d.sections[k].tasks=(d.sections[k].tasks||[]).map(function(t){return typeof t==='string'?{name:t,progress:0}:t})});currentData=d}
            else{currentData=JSON.parse(JSON.stringify(DEFAULT_DATA));dataRef.set(currentData)}
            renderSidebar();renderTasks();
            if(fl){fl=false;setTimeout(function(){document.getElementById('loadingOverlay').classList.add('hidden')},400)}
        });

        document.addEventListener('DOMContentLoaded',function(){setTimeout(function(){document.querySelectorAll('.sidebar .form-input').forEach(function(inp){inp.addEventListener('input',function(){sfb()})})},2000)});
        setTimeout(function(){if(fl){currentData=JSON.parse(JSON.stringify(DEFAULT_DATA));renderSidebar();renderTasks();document.getElementById('loadingOverlay').classList.add('hidden')}},5000);
    </script>
</body>
</html>
