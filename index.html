<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸáÿßŸÖ ÿßŸÑŸäŸàŸÖŸäÿ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&family=Changa:wght@400;600;700;800&family=Aref+Ruqaa:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient-start:#f0faf0;--bg-gradient-end:#e8f5e8;--card-bg:#c8f5d8;
            --accent-purple:#5b2d8e;--accent-green-dark:#2d5a3d;
            --text-dark:#1a1a2e;--text-muted:#4a4a6a;
            --shadow-card:0 6px 30px rgba(91,45,142,0.1);
            --progress-bg:rgba(91,45,142,0.12);
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Tajawal',sans-serif;background:linear-gradient(135deg,var(--bg-gradient-start),#f5fef5,var(--bg-gradient-end));height:100vh;color:var(--text-dark);overflow:hidden}
        .container{display:grid;grid-template-columns:1fr 2.2fr;height:100vh}

        /* === LEFT PANEL === */
        .left-panel{display:flex;flex-direction:column;justify-content:center;padding:4vh 2.5vw;padding-bottom:8vh;background:linear-gradient(180deg,#e8f8e8,#d4ecd4,#c8e0c8);position:relative;overflow:hidden}
        .logo-area{position:absolute;top:3vh;right:2vw;width:clamp(120px,9vw,200px);height:clamp(120px,9vw,200px);background:#c0392b;border-radius:22px 22px 0 22px;display:flex;align-items:center;justify-content:center;color:white;font-family:'Changa',sans-serif;font-weight:800;font-size:clamp(1.2rem,1.8vw,2.2rem);text-align:center;line-height:1.4;box-shadow:0 8px 30px rgba(192,57,43,0.4)}
        .conn-status{position:fixed;top:2vh;left:2vw;display:flex;align-items:center;gap:0.6rem;padding:0.6rem 1.4rem;border-radius:50px;font-size:clamp(1rem,1.2vw,1.5rem);font-weight:600;z-index:100}
        .conn-status.on{background:rgba(52,211,153,0.15);color:#059669;border:1px solid rgba(52,211,153,0.3)}
        .conn-status.off{background:rgba(239,68,68,0.15);color:#dc2626;border:1px solid rgba(239,68,68,0.3)}
        .conn-status .dot{width:12px;height:12px;border-radius:50%;animation:pulse 2s infinite}
        .conn-status.on .dot{background:#059669}.conn-status.off .dot{background:#dc2626}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}

        .quote-section{position:relative;z-index:1;padding-top:clamp(80px,8vh,150px)}
        .quote-title{font-family:'Changa',sans-serif;font-weight:800;font-size:clamp(2.2rem,3.5vw,4.5rem);color:var(--accent-green-dark);line-height:1.35;margin-bottom:2.5vh}
        .quote-author{font-family:'Aref Ruqaa',serif;font-size:clamp(1.4rem,2vw,2.8rem);color:var(--accent-purple);margin-bottom:2.5vh;padding:0.5rem 1.5rem;background:rgba(91,45,142,0.08);display:inline-block;border-radius:8px}
        .quote-text{font-family:'Tajawal',sans-serif;font-size:clamp(1.1rem,1.4vw,2rem);line-height:2;color:var(--text-dark);max-width:95%;position:relative;padding:2.5vh 2vw;background:rgba(255,255,255,0.4);border-radius:16px;border:1px solid rgba(91,45,142,0.06)}
        .quote-text::before{content:'\00AB';font-size:clamp(3rem,4vw,5rem);color:var(--accent-purple);opacity:0.3;position:absolute;top:-0.3rem;right:1rem;font-family:'Aref Ruqaa',serif}

        .date-bar{position:absolute;bottom:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center;padding:2vh 2.5vw;background:rgba(255,255,255,0.5);border-top:1px solid rgba(91,45,142,0.08)}
        .date-hijri{font-weight:700;color:var(--accent-purple);font-size:clamp(1.2rem,1.6vw,2rem)}
        .date-hijri-year{font-weight:600;color:var(--text-muted);font-size:clamp(1.2rem,1.6vw,2rem)}
        .date-gregorian{font-weight:600;color:var(--accent-green-dark);font-size:clamp(1.2rem,1.6vw,2rem);letter-spacing:2px;text-transform:uppercase}

        /* === RIGHT PANEL - TASKS === */
        .right-panel{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:clamp(0.8rem,1.2vw,1.5rem);padding:clamp(0.8rem,1.2vw,1.5rem);overflow:hidden}
        .task-card{background:var(--card-bg);border-radius:20px;padding:clamp(1rem,1.5vw,2rem);display:flex;flex-direction:column;overflow:hidden;position:relative;border:1px solid rgba(91,45,142,0.06);box-shadow:var(--shadow-card)}
        .task-card::after{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--accent-purple),transparent);opacity:0.3;border-radius:20px 20px 0 0}
        .card-header{text-align:center;margin-bottom:clamp(0.5rem,1vh,1rem);padding-bottom:clamp(0.4rem,0.8vh,0.8rem);border-bottom:3px solid rgba(91,45,142,0.12)}
        .card-title{font-family:'Changa',sans-serif;font-weight:800;font-size:clamp(1.4rem,2vw,2.8rem);color:var(--accent-purple)}

        .task-list{flex:1;display:flex;flex-direction:column;gap:clamp(0.3rem,0.6vh,0.6rem);overflow-y:auto}
        .task-list::-webkit-scrollbar{width:5px}.task-list::-webkit-scrollbar-thumb{background:rgba(91,45,142,0.25);border-radius:5px}

        .task-item{display:flex;flex-direction:column;gap:clamp(0.2rem,0.4vh,0.4rem);padding:clamp(0.5rem,0.8vw,1rem) clamp(0.6rem,1vw,1.2rem);background:rgba(255,255,255,0.35);border-radius:12px;border-bottom:1px solid rgba(91,45,142,0.05)}
        .task-item.completed{opacity:0.55}
        .task-item.completed .task-name{text-decoration:line-through}
        .task-top{display:flex;align-items:center;gap:clamp(0.4rem,0.6vw,0.8rem)}
        .task-name{flex:1;font-size:clamp(1rem,1.4vw,2rem);font-weight:600;color:var(--text-dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

        .progress-wrapper{display:flex;align-items:center;gap:clamp(0.3rem,0.5vw,0.6rem);min-width:clamp(80px,8vw,140px);direction:ltr}
        .progress-bar-bg{flex:1;height:clamp(6px,0.6vw,10px);background:var(--progress-bg);border-radius:10px;overflow:hidden}
        .progress-bar-fill{height:100%;border-radius:10px;transition:width 0.6s ease;position:relative}
        .progress-bar-fill.low{background:linear-gradient(90deg,#e74c3c,#e67e22)}
        .progress-bar-fill.mid{background:linear-gradient(90deg,#f39c12,#e67e22)}
        .progress-bar-fill.high{background:linear-gradient(90deg,#27ae60,#2ecc71)}
        .progress-bar-fill.full{background:linear-gradient(90deg,#2ecc71,#27ae60)}
        .progress-bar-fill.full::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 2s infinite}
        @keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
        .progress-percent{font-size:clamp(0.8rem,1vw,1.4rem);font-weight:700;min-width:clamp(28px,3vw,50px);text-align:left}
        .progress-percent.low{color:#e74c3c}.progress-percent.mid{color:#f39c12}.progress-percent.high{color:#27ae60}.progress-percent.full{color:#2ecc71}

        .task-meta{display:flex;align-items:center;gap:clamp(0.3rem,0.5vw,0.6rem);flex-wrap:wrap}
        .task-assignee{font-size:clamp(0.75rem,1vw,1.3rem);color:var(--accent-purple);background:rgba(91,45,142,0.08);padding:0.2rem clamp(0.4rem,0.6vw,0.8rem);border-radius:50px;display:inline-flex;align-items:center;gap:0.3rem;white-space:nowrap}
        .task-assignee::before{content:'üë§';font-size:clamp(0.65rem,0.8vw,1rem)}
        .task-status{font-size:clamp(0.7rem,0.95vw,1.2rem);padding:0.2rem clamp(0.5rem,0.7vw,1rem);border-radius:8px;font-weight:700;white-space:nowrap}
        .task-status.done{background:#1a6b3c;color:#fff;border:none}
        .task-status.in-progress{background:#c4b44e;color:#1a1a2e;border:none}
        .task-status.delayed{background:#d42e2e;color:#fff;border:none}
        .task-status.paused{background:#c8a2e0;color:#2e0854;border:none}
        .task-status.no-updates{background:#555;color:#fff;border:none}

        .empty-state{color:var(--text-muted);text-align:center;font-size:clamp(1rem,1.3vw,1.6rem);opacity:0.6;padding:3vh 0}

        .loading-overlay{position:fixed;inset:0;background:rgba(240,250,240,0.9);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:999;transition:opacity 0.5s}
        .loading-overlay.hidden{opacity:0;pointer-events:none}
        .loading-spinner{width:60px;height:60px;border:5px solid rgba(91,45,142,0.15);border-top-color:var(--accent-purple);border-radius:50%;animation:spin 0.8s linear infinite}
        .loading-text{margin-top:1.5rem;font-family:'Changa',sans-serif;color:var(--accent-purple);font-weight:700;font-size:1.5rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .task-card{animation:fadeInUp 0.6s ease forwards}
        .task-card:nth-child(1){animation-delay:0.1s}.task-card:nth-child(2){animation-delay:0.2s}.task-card:nth-child(3){animation-delay:0.3s}.task-card:nth-child(4){animation-delay:0.4s}
        .quote-section{animation:fadeInUp 0.8s ease 0.3s forwards;opacity:0}

        /* === MOBILE FALLBACK === */
        @media(max-width:1024px){
            .container{grid-template-columns:1fr;height:auto;min-height:100vh}
            .left-panel{padding:2rem 1.5rem;padding-bottom:5rem;min-height:auto}
            .right-panel{grid-template-columns:1fr 1fr;padding:1rem;gap:1rem;height:auto}
            body{overflow:auto;height:auto}
        }
        @media(max-width:768px){
            .left-panel{padding:1.5rem 1.2rem;padding-top:5rem;padding-bottom:5rem}
            .logo-area{top:1rem;right:1rem;width:80px;height:80px;font-size:0.85rem}
            .quote-title{font-size:1.6rem}.quote-author{font-size:1.1rem}.quote-text{font-size:0.92rem;line-height:1.8;padding:1rem}
            .date-bar{padding:0.8rem 1.2rem;flex-wrap:wrap;gap:0.3rem;justify-content:center}
            .date-hijri,.date-hijri-year,.date-gregorian{font-size:0.85rem}
            .right-panel{grid-template-columns:1fr;padding:1rem;gap:1rem;overflow:visible}
            .task-card{padding:1rem}.card-title{font-size:1.15rem}.task-name{font-size:0.85rem}
            .conn-status{top:0.5rem;left:0.5rem;font-size:0.7rem;padding:0.3rem 0.6rem}
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div><div class="loading-text">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div></div>
    <div class="conn-status off" id="cs"><span class="dot"></span><span id="ct">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ...</span></div>
    <div class="container">
        <div class="left-panel">
            <div class="logo-area"><span>ÿµŸèŸÜÿπ<br>ŸÅŸä<br>ÿ£ŸáÿØÿßŸÅ</span></div>
            <div class="quote-section">
                <h1 class="quote-title" id="quoteTitle"></h1>
                <div class="quote-author" id="quoteAuthor"></div>
                <p class="quote-text" id="quoteText"></p>
            </div>
            <div class="date-bar">
                <span class="date-hijri" id="dateHijri"></span>
                <span class="date-hijri-year" id="dateHijriYear"></span>
                <span class="date-gregorian" id="dateGregorian"></span>
            </div>
        </div>
        <div class="right-panel">
            <div class="task-card" id="card-project-management"><div class="card-header"><h2 class="card-title">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ</h2></div><div class="task-list" id="tasks-project-management"></div></div>
            <div class="task-card" id="card-influencers"><div class="card-header"><h2 class="card-title">ÿßŸÑŸÖÿ§ÿ´ÿ±ŸäŸÜ</h2></div><div class="task-list" id="tasks-influencers"></div></div>
            <div class="task-card" id="card-public-relations"><div class="card-header"><h2 class="card-title">ÿßŸÑÿπŸÑÿßŸÇÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©</h2></div><div class="task-list" id="tasks-public-relations"></div></div>
            <div class="task-card" id="card-production"><div class="card-header"><h2 class="card-title">ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨</h2></div><div class="task-list" id="tasks-production"></div></div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script>
        firebase.initializeApp({apiKey:"AIzaSyCiyb2ApY6K3YeNdeC6C8wjmWSeNYTZ03E",authDomain:"taskboard-ahdaf.firebaseapp.com",databaseURL:"https://taskboard-ahdaf-default-rtdb.europe-west1.firebasedatabase.app",projectId:"taskboard-ahdaf",storageBucket:"taskboard-ahdaf.firebasestorage.app",messagingSenderId:"576532765761",appId:"1:576532765761:web:33a0cc6888dd229e81fac0"});
        var db=firebase.database(),dataRef=db.ref('taskboard');
        var statusLabels={'done':'ŸÖŸÉÿ™ŸÖŸÑÿ©','in-progress':'ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞','delayed':'ŸÖÿ§ÿ¨ŸÑÿ©','paused':'ŸÖÿ™ŸàŸÇŸÅÿ©','no-updates':'ŸÑÿßŸäŸàÿ¨ÿØ ÿ™ÿ≠ÿØŸäÿ´ÿßÿ™'};
        var DEFAULT_DATA={sections:{"project-management":{title:"ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ",tasks:[{name:"ŸÖÿ™ÿßÿ®ÿπÿ© ÿ¨ÿßÿ≤Ÿä",progress:0,assignee:"",status:""},{name:"ÿßŸÇŸÅÿßŸÑ ÿ≠ŸÖŸÑÿ© ÿØŸàŸÑÿßÿ™Ÿà",progress:0,assignee:"",status:""},{name:"ŸÖÿ™ÿßÿ®ÿπÿ© ÿπŸÖŸÑ ŸäŸÑŸà ŸÖÿπ ÿßŸÑŸÖÿ§ÿ´ÿ±ŸäŸÜ",progress:0,assignee:"",status:""},{name:"ŸÖÿ™ÿßÿ®ÿπÿ© ÿ≠ŸÖŸÑÿ© ŸÅÿ±ÿ¥ŸÑŸä ŸÖÿπ ÿßŸÑŸÖÿ§ÿ´ÿ±ŸäŸÜ",progress:0,assignee:"",status:""}]},"influencers":{title:"ÿßŸÑŸÖÿ§ÿ´ÿ±ŸäŸÜ",tasks:[{name:"ÿπÿ±ÿ∂ ÿ≥ÿπÿ± ÿØŸäŸÑ ÿ®ÿßŸÑÿßÿ≥ÿπÿßÿ± ÿßŸÑÿØÿßÿÆŸÑŸäŸá",progress:0,assignee:"",status:""},{name:"ŸÖŸÑŸÅ ŸÉŸÜÿ™ÿßŸÉŸä",progress:0,assignee:"",status:""},{name:"ÿßÿπŸÑÿßŸÜÿßÿ™ ÿ¨ÿßÿ≤Ÿä",progress:0,assignee:"",status:""},{name:"ÿ™ÿπÿØŸäŸÑÿßÿ™ ŸÅÿ±ÿ¥ŸÑŸä",progress:0,assignee:"",status:""},{name:"ÿ™ÿπŸÖŸäÿØÿßÿ™ ÿ≥ŸÑŸÉ",progress:0,assignee:"",status:""},{name:"ŸÖÿ™ÿßÿ®ÿπŸá ÿ≥ŸáŸÖ ŸÜÿ¥ÿ± ÿßÿπŸÑÿßŸÜ ŸäŸÑŸà",progress:0,assignee:"",status:""},{name:"ÿ±ÿ≥Ÿäÿ≥ ŸÖŸÑŸÅ",progress:0,assignee:"",status:""},{name:"ÿ≥ŸäŸÖŸÅŸàŸÜŸä ŸÖŸÇÿ™ÿ±ÿ≠ÿßÿ™",progress:0,assignee:"",status:""},{name:"ÿØŸàŸÑÿßÿ™Ÿà ÿ™ÿπÿØŸäŸÑÿßÿ™",progress:0,assignee:"",status:""}]},"public-relations":{title:"ÿßŸÑÿπŸÑÿßŸÇÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©",tasks:[{name:"ŸÜÿ¥ÿ± ŸÑŸäŸÜŸÉÿØŸÜ",progress:0,assignee:"",status:""},{name:"ÿÆÿ∑ÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ",progress:0,assignee:"",status:""}]},"production":{title:"ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨",tasks:[{name:"ÿ¨ÿØŸàŸÑÿ© ÿ™ÿµŸàŸäÿ± ŸÖÿ≥ÿ™ŸáÿØŸÅÿßÿ™ ŸäŸÑŸà",progress:0,assignee:"",status:""},{name:"ÿßŸÑÿπŸÖŸÑ ÿπŸÑŸâ ÿ™ÿµŸÖŸäŸÖ ŸÇŸàÿßŸÑÿ® ŸÖÿ≠ŸÖÿØÿ≤",progress:0,assignee:"",status:""},{name:"ÿ™ÿπÿØŸäŸÑÿßÿ™ ŸÖŸàÿ¨ÿ≤",progress:0,assignee:"",status:""},{name:"ÿ™ÿπÿØŸäŸÑÿßÿ™ ŸäŸÑŸà",progress:0,assignee:"",status:""},{name:"ÿπÿ±ÿ∂ ÿ≥ÿπÿ± ÿßŸÑÿπÿ±ÿ®ÿ© ÿßŸÑŸÜÿßÿØÿ±ÿ©",progress:0,assignee:"",status:""},{name:"ÿ¨ÿØŸàŸÑÿ© ŸÜÿ¥ÿ± ŸÅŸäÿØŸäŸàŸáÿßÿ™ ŸÖŸàÿ¨ÿ≤",progress:0,assignee:"",status:""}]}},quote:{title:"ÿ≠ŸäŸÜ ÿ™ÿ™ÿ≠ŸàŸëŸÑ ŸÉÿ´ÿ±ÿ© ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿ•ŸÑŸâ ÿπÿ®ÿ°",author:"ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ≠ÿßÿ¨Ÿä",text:"Ÿàÿ¨ÿØÿ™ ÿ•ÿ≠ÿØŸâ ÿßŸÑÿØÿ±ÿßÿ≥ÿßÿ™ ÿ£ŸÜ ÿßŸÑÿ£ÿ¥ÿÆÿßÿµ ÿßŸÑÿ∞ŸäŸÜ ÿ™ŸàŸÅŸëÿ±ÿ™ ŸÑŸáŸÖ ŸÖÿ≥ÿßÿ±ÿßÿ™ ŸÖŸáŸÜŸäÿ© ŸÉÿ´Ÿäÿ±ÿ© ŸäÿπŸäÿ¥ŸàŸÜ ŸÇŸÑŸÇ ÿ£ÿπŸÑŸâ Ÿàÿ±ÿ∂ÿß ŸÖŸÜÿÆŸÅÿ∂. ŸÖŸÇÿßÿ±ŸÜÿ©Ÿã ÿ®ÿ£ÿµÿ≠ÿßÿ® ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ£ŸÇŸÑÿå ŸÅÿßŸÑÿ™ÿ∂ÿÆŸÖ ÿ®ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ŸÑÿß ŸäŸÖŸÜÿ≠ŸÜÿß ÿßŸÑÿ≠ÿ±ŸäŸëÿ© ÿßŸÑŸÖŸàÿπŸàÿØÿ©ÿå ÿ®ŸÑ ŸäŸàŸÑÿØ ŸÑÿØŸäŸÜÿß ÿ≠ÿßŸÑÿ© ÿ™ÿ¥ÿ®Ÿá ÿ¥ŸÑŸÑ ÿßŸÑŸÇÿ±ÿßÿ±."},date:{hijri:"",hijriYear:"",gregorian:""}};

        function gpc(p){if(p>=100)return'full';if(p>=60)return'high';if(p>=30)return'mid';return'low'}

        function setAutoDate(){
            var now=new Date();
            var arDays=['ÿßŸÑÿ£ÿ≠ÿØ','ÿßŸÑÿ•ÿ´ŸÜŸäŸÜ','ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°','ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°','ÿßŸÑÿÆŸÖŸäÿ≥','ÿßŸÑÿ¨ŸÖÿπÿ©','ÿßŸÑÿ≥ÿ®ÿ™'];
            var enDays=['SUN','MON','TUE','WED','THU','FRI','SAT'];
            var enMonths=['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
            var toAr=function(n){var digits='Ÿ†Ÿ°Ÿ¢Ÿ£Ÿ§Ÿ•Ÿ¶ŸßŸ®Ÿ©';return String(n).replace(/[0-9]/g,function(d){return digits[parseInt(d)]})};
            document.getElementById('dateGregorian').textContent=enDays[now.getDay()]+' - '+now.getDate()+' - '+enMonths[now.getMonth()];
            try{
                var hDay=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{day:'numeric'}).format(now);
                var hMonth=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{month:'long'}).format(now);
                var hYear=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{year:'numeric'}).format(now);
                var dayNum=hDay.replace(/[^\dŸ†-Ÿ©]/g,'');
                var yearNum=hYear.replace(/[^\dŸ†-Ÿ©]/g,'');
                document.getElementById('dateHijri').textContent=arDays[now.getDay()]+' - '+dayNum+' - '+hMonth;
                document.getElementById('dateHijriYear').textContent=yearNum+' / '+now.getFullYear();
            }catch(e){
                document.getElementById('dateHijri').textContent=arDays[now.getDay()]+' - '+toAr(now.getDate());
                document.getElementById('dateHijriYear').textContent=''+now.getFullYear();
            }
        }

        function render(data){
            if(!data)data=DEFAULT_DATA;
            var keys=Object.keys(data.sections);
            for(var k=0;k<keys.length;k++){
                var key=keys[k],c=document.getElementById('tasks-'+key);
                if(!c)continue;
                var s=data.sections[key];c.innerHTML='';
                var card=document.getElementById('card-'+key);
                if(card)card.querySelector('.card-title').textContent=s.title;
                var tasks=s.tasks||[];
                if(tasks.length===0){c.innerHTML='<div class="empty-state">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸáÿßŸÖ</div>';continue}
                for(var i=0;i<tasks.length;i++){
                    var t=tasks[i];
                    if(typeof t==='string')t={name:t,progress:0,assignee:'',status:''};
                    var nm=t.name,pr=t.progress||0,cl=gpc(pr),asgn=t.assignee||'',st=t.status||'';
                    var d=document.createElement('div');
                    d.className='task-item'+(st==='done'?' completed':'');
                    var metaHtml='';
                    if(asgn||st){
                        metaHtml='<div class="task-meta">';
                        if(asgn)metaHtml+='<span class="task-assignee">'+asgn+'</span>';
                        if(st&&statusLabels[st])metaHtml+='<span class="task-status '+st+'">'+statusLabels[st]+'</span>';
                        metaHtml+='</div>';
                    }
                    d.innerHTML='<div class="task-top"><span class="task-name">'+nm+'</span><div class="progress-wrapper"><div class="progress-bar-bg"><div class="progress-bar-fill '+cl+'" style="width:'+pr+'%"></div></div><span class="progress-percent '+cl+'">'+pr+'%</span></div></div>'+metaHtml;
                    c.appendChild(d);
                }
            }
            if(data.quote){document.getElementById('quoteTitle').textContent=data.quote.title||'';document.getElementById('quoteAuthor').textContent=data.quote.author||'';document.getElementById('quoteText').textContent=data.quote.text||''}
            setAutoDate();
            var fs=data.fontSizes||{quoteTitle:0,quoteAuthor:0,quoteText:0,sectionTitle:0,taskName:0};
            if(fs.quoteTitle)document.getElementById('quoteTitle').style.fontSize=fs.quoteTitle+'px';
            if(fs.quoteAuthor)document.getElementById('quoteAuthor').style.fontSize=fs.quoteAuthor+'px';
            if(fs.quoteText)document.getElementById('quoteText').style.fontSize=fs.quoteText+'px';
            if(fs.sectionTitle)document.querySelectorAll('.card-title').forEach(function(el){el.style.fontSize=fs.sectionTitle+'px'});
            if(fs.taskName)document.querySelectorAll('.task-name').forEach(function(el){el.style.fontSize=fs.taskName+'px'});
        }
        db.ref('.info/connected').on('value',function(s){var e=document.getElementById('cs'),t=document.getElementById('ct');if(s.val()){e.className='conn-status on';t.textContent='ŸÖÿ™ÿµŸÑ'}else{e.className='conn-status off';t.textContent='ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ'}});
        var fl=true;
        dataRef.on('value',function(snap){var d=snap.val();if(d){render(d)}else{dataRef.set(DEFAULT_DATA);render(DEFAULT_DATA)}if(fl){fl=false;setTimeout(function(){document.getElementById('loadingOverlay').classList.add('hidden')},400)}});
        setTimeout(function(){if(fl){render(DEFAULT_DATA);document.getElementById('loadingOverlay').classList.add('hidden')}},5000);
    </script>
</body>
</html>
